function nmdrMenu(e){var n=nmdr.core.$(e,"nmdrMenu");if(null!=n)return n.imagePath="img/",n.menu=null,n.currentMenu=null,n.menus={},n.items={},n.init=function(e){e&&(this.imagePath=e+"/"),this.menu=this.prepareMenu();var n=this,t="<style>"+("#"+this.id)+":hover {cursor:pointer;}.nmdrMenuTr {height:24px;}.nmdrMenuTr:hover {color:#fff;background:#33AAFF !important; cursor:pointer;}.nmdrMenuClose:hover {cursor:pointer;}hr.nmdrMenuHr {border:0px;height:1px;background-color:#B0C4DE;color:#B0C4DE}</style>";document.write(t);var i=function(e,t){var o=n.id+"_nmdrMenu_"+e.name,s=[];s.push("<div class='nmdrMenu' id='"+o+"' style='position:absolute;top:-250;left:0;width:1px;height:1px;"),s.push("z-index:100;display:none;padding:3px;background-color:#fff;border:1px solid #bbb;"),s.push("font-family:arial,verdana,sans-serif;font-weight:normal;font-size:12px;box-shadow:5px 5px 5px #eee'>"),s.push("</div>"),document.write(s.join("")),e.id=o,e.dom=document.getElementById(o),e.parentMenu=t,e.opened=!1,null==e.width&&(e.width=150),null==e.showClose&&(e.showClose=!1),n.menus[o]=e;for(var d=0;d<e.items.length;d++){var r=e.items[d];r.menu&&i(r.menu,e)}};i(this.menu,null),this.onclick=function(e){n.openMenu(e,n.menu.id)}},n.makeMenu=function(e,n,t){if(t){n.dom.innerHTML="<div style='position:absolute; height:100%; width:100%; top:0px; left:0px; cursor:wait;background:#fff url("+this.imagePath+"loading.gif) no-repeat center center;opacity:0.75; z-index:101;'></div>";var i=document.body;return n.dom.style.position="absolute",n.dom.style.left=e.clientX+i.scrollLeft+"px",n.dom.style.top=e.clientY+i.scrollTop+"px",n.dom.style.width=n.width+"px",n.dom.style.height=20*n.items.length+"px",void(n.dom.style.display="block")}var o=[];o.push("<table cellpadding='0' cellspacing='0' border='0' width='100%' height='100%'>"),n.showClose&&(o.push("<tr style='height:20px'><td class='nmdrMenuClose' colspan='3' style='text-align:right;background:#eee;padding:2px 3px 0 0;'>"),o.push("<img class='nmdrMenuClose' src='"+this.imagePath+"dmclose.png' "),o.push("onclick=\"nmdr.core.$('"+this.id+"').closeMenu('"+n.id+"')\"></td></tr>"));for(var s=0,d=0,r=0;r<n.items.length;r++){var a=n.items[r];"#separator"==a.name?(o.push("<tr><td colspan='3'><hr class='nmdrMenuHr'></td></tr>"),s++):(a.id=n.id+"_tr"+r,o.push("<tr class='nmdrMenuTr' id='"+a.id+"' "),o.push((a.enabled?"onclick=\"nmdr.core.$('"+this.id+"').itemClick(event,'"+n.id+"',"+r+')"'+(a.menu?"":" onmouseover=\"nmdr.core.$('"+this.id+"').closeMenu('"+n.id+"', true)\""):"style='opacity:0.5;'")+">"),o.push("<td style='width:24px;padding:3px 0 0 5px;'><img src='"+this.imagePath+a.icon+"'></td>"),o.push("<td><span>"+a.name+"</span></td>"),o.push("<td style='width:10px;padding:0 0 0 0;'>"+(a.menu?"<img src='"+this.imagePath+"/submenu.gif'>":"")+"</td>"),o.push("</tr>"),d++)}o.push("</table>");var u=n.showClose?20:0;n.dom.style.width=n.width+"px",n.dom.style.height=24*d+14*s+u+"px",n.dom.innerHTML=o.join("")},n.canClose=function(e){if("nmdrMenuClose"==e.className)return!1;var n=function(t){for(var i=0;i<t.items.length;i++){var o=t.items[i];if(o.id==e.id)return o;for(var s=e.parentElement;null!=s;){if(s.id==o.id)return o;s=s.parentElement}if(o.menu)return n(o.menu)}return null},t=n(this.menu);return!t||!t.menu},n.openMenu=function(e,n){var t=this,i=this.menus[n];i.opened&&this.closeMenu(n,!0),t.makeMenu(e,i,!0),n==t.menu.id&&nmdr.core.popup.open(i.dom,t,null,function(e){t.closeMenu(t.menu.id,!1,e)},function(e,n){return t.canClose(n)}),nmdr.core.animate.fadeIn(null,i.dom,null,!0),window.setTimeout(function(){t.checkItems(i,function(){t.makeMenu(e,i,!1),i.opened=!0})},10)},n.closeMenu=function(e,n,t){var i=this,o=this.menus[e],s=function(o){for(var d=0;d<o.items.length;d++){var r=o.items[d];r.menu&&r.menu.opened&&(s(r.menu),document.getElementById(r.id).style.background="#ffffff")}n&&o.id==e||nmdr.core.animate.fadeOut(null,o.dom,null,!0,function(){if(o.dom.style.top="-250",o.dom.style.left="0",o.dom.style.display="none",o.opened=!1,o.id==i.menu.id)nmdr.core.popup.close(),t&&t();else if(o.parentMenu)for(var e=0;e<o.parentMenu.items.length;e++){var n=o.parentMenu.items[e];n.menu&&(document.getElementById(n.id).style.background="#ffffff")}})};s(o)},n.itemClick=function(e,n,t){var i=this.menus[n],o=i.items[t];if(o.menu)document.getElementById(o.id).style.background="#ABD6F5",this.openMenu(e,o.menu.id);else{var s=this;this.closeMenu(this.menu.id,!1,function(){s.execute(i.name,o.name)})}},n.checkItems=function(e,n){"M1"==e.name&&(e.items[2].enabled=!1),n()},n.execute=function(e,n){alert(e+"  "+n)},n.prepareMenu=function(){return{name:"M1",showClose:!1,width:200,items:[{name:"open item...",icon:"details.gif",enabled:!0,action:"view"},{name:"edit item...",icon:"editdetails.gif",enabled:!0,action:"edit"},{name:"delete item...",icon:"delete.gif",enabled:!0,action:"delete"},{name:"#separator"},{name:"show details...",icon:"new.gif",enabled:!0,action:"showdetails"},{name:"edit details...",icon:"edititem.gif",enabled:!0,action:"editdetails"},{name:"#separator"},{name:"refresh page...",icon:"menu/refpage.png",enabled:!0,action:"refresh",menu:{name:"SM1",showClose:!0,items:[{name:"show exchange..",icon:"menu/globalx.png",enabled:!0,action:"view"},{name:"edit item...",icon:"editdetails.gif",enabled:!0,action:"edit"},{name:"delete item...",icon:"uncheck.png",enabled:!0,action:"delete"},{name:"#separator"},{name:"user properties...",icon:"menu/users.png",enabled:!0,action:"refresh"}]}}]}},n}