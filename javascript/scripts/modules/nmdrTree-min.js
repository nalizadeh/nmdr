function nmdrTree(e){var t=nmdr.core.$(e,"nmdrTree");if(null!=t)return t.props={imagePath:"img/",doPostBack:!1,multiSelection:!1,showRowCommands:!0,lineHeight:"18px",color:"#000000",backColor:"#ffffff",rowSelectionColor:"rgba(156, 206, 240, 0.5)",rowHOverColor:"rgba(205,230,247,0.5)",rowAlternateColor:"rgba(242,246,252,0.5)",checkSelectionColor:"rgb(0,113,198)",showBorder:!0,showShadow:!0,borderColor:"rgb(207,208,210)",borderWidth:"1px",fontStyle:"Arial, Helvetica, sans-serif",fontWidth:"normal",fontSize:"13px",headerColor:"#000000",headerBackColor:"rgb(248, 248, 248)",headerFontStyle:"Arial, Helvetica, sans-serif",headerFontWidth:"bold",headerFontSize:"13px"},t.columns=[],t.widths=[],t.treeviewData=[],t.selections=[],t.clickedRow=-1,t.firstRow=0,t.lastRow=0,t.init=function(e){(e=e||{}).data?(this.props=nmdr.core.utils.mergeProperties(this.props,e),this.updateData(this.props.data)):alert("[nmdrTree]\n\nParameter 'data' does not exist.")},t.headerCellTemplate=function(e,t){return null},t.itemCellTemplate=function(e,t,i,s){return null},t.columnWidthTemplate=function(e){return null},t.handleEvents=function(e){},t.openItem=function(e){alert("open row: "+e)},t.editItem=function(e){alert("edit row: "+e)},t.deleteItem=function(e){alert("delete row: "+e)},t.makeViewer=function(){var e="#"+this.id,t="<style type='text/css'>"+e+" { position:relative !important; }"+e+" .nmdrTR_content {  line-height: "+this.props.lineHeight+";  color:"+this.props.color+";  background:"+this.props.backColor+";  font-family: "+this.props.fontStyle+";  font-weight: "+this.props.fontWidth+";  font-size: "+this.props.fontSize+";  border-width:"+(this.props.showBorder?this.props.borderWidth:"0px")+";  border-color:"+this.props.borderColor+";  border-style: solid;  cursor: default;  -webkit-user-select: none;  -moz-user-select: none;  -ms-user-select: none;   user-select: none;"+(this.props.showShadow?"box-shadow:3px 3px 3px #ccc;":"")+"}"+e+" .nmdrTR_table td {   padding-top: 2px;   padding-bottom: 2px;   padding-right: 2px;   padding-left: 2px;}"+e+" .nmdrTR_header {  background: lightgray;  line-height: "+(this.props.lineHeight+8)+";}"+e+" .nmdrTR_header_th {  color: "+this.props.headerColor+";  background: "+this.props.headerBackColor+";  font-family: "+this.props.headerFontStyle+";  font-weight: "+this.headerFontWidth+";  font-size: "+this.props.headerFontSize+";  border-bottom-width:"+(this.props.showBorder?this.props.borderWidth:"0px")+";  border-bottom-color:"+this.props.borderColor+";  border-bottom-style: solid;  padding: 2px;  text-align: left;}"+e+" .nmdrTR_header_th span, img {vertical-align: middle;}"+e+" .nmdrTR_tr:hover {background: "+this.props.rowHOverColor+" !important;}"+e+" .nmdrTR_tr:hover td:first-child {background: "+this.props.rowHOverColor+" !important;}"+e+" .nmdrTR_tr:hover td:first-child span:first-of-type {display:inline !important;}"+e+" .nmdrTR_tr:hover td a.nmdrTR_rowcontrol {display: inline !important; opacity: 0.3 !important;}"+e+" .nmdrTR_tr_sel:hover td a.nmdrTR_rowcontrol {display: inline !important; opacity: 1 !important;}"+e+" .nmdrTR_td_folarw:hover, a.nmdrTR_rowcontrol:hover {cursor:pointer;}</style>",i=[];i.push(t),i.push("<script type='text/javascript'><\/script>"),i.push("<div id='"+this.id+"nmdrTR_root' width:100%;height:100%;overflow:hidden;clear:both;'>"),i.push("<div id='"+this.id+"nmdrTR_content' class='nmdrTR_content' style='overflow:hidden;'>"),i.push(this.makeTable()),i.push("</div>"),i.push("</div>"),this.innerHTML=i.join(""),this.initEvents()},t.makeTable=function(){var e=[],t=this.widths.length>0?" style='table-layout: fixed;'":"";return e.push("<table class='nmdrTR_table' width='100%' border='0' cellpadding='0' cellspacing='0' onselectstart='return false' ondragstart='return false'"+t+">"),e.push(this.makeHeader()),e.push(this.makeBody(!0)),e.push("</table>"),e.join("")},t.makeHeader=function(){var e=[];e.push("<thead class='nmdrTR_header'><tr class='nmdrTR_header_tr'>"),e.push("<th class='nmdrTR_header_th' style='width:20px;text-align:center;'>"),e.push("<img src='"+this.props.imagePath+"spCheck.png' onClick=\"nmdr.core.$('"+this.id+"').selectAll();\"></th>");for(var t=0;t<this.columns.length;t++){var i=this.widths[t],s=i&&!i.endsWith("%")?"style='width:"+i+"'":"";e.push("<th class='nmdrTR_header_th'"+s+"> <span>"+this.columns[t]+"</span></th>")}return e.push("</tr></thead>"),e.join("")},t.makeBody=function(){var e=this,t=function(i,s,r,o){var n=e.props,l=s%2==0,d=s===e.clickedRow,a=-1!==e.selections.indexOf(s),h=a?n.rowSelectionColor:l?n.rowAlternateColor:n.backColor,c=a?n.checkSelectionColor:l?n.rowAlternateColor:n.backColor;i.push("<tr class='nmdrTR_tr"+(d?"_sel":"")+"' id='nmdrTR_tr#"+s+"' onClick=\"nmdr.core.$('"+e.id+"').selectRow(event, "+s+");\" style='background:"+h+" '>"),i.push("<td style='width:20px; text-align:center; background:"+c+"'>"),i.push("<span style='display:"+(a?"inline":"none")+"'>"),i.push("<img src='"+n.imagePath+"spCheck"+(a?"Sel":"")+".png'></span></td>");var p=r.data;if(r.sub)i.push("<td class='nmdrTR_tr_td' colspan="+e.columns.length+" style='text-align:left; background:"+h+"'>"+p[0]+"</td></tr>");else{for(var u=0;u<p.length;u++)if(0==u){i.push("<td class='nmdrTR_td' style='text-align:right;'>"),i.push("<table border='0' cellpadding='0' cellspacing='0'><tr>");for(g=0;g<r.dep;g++)i.push("<td style='width:14px;'></td>");i.push("<td style='width:14px;vertical-align:middle'"+(r.fol?" class='nmdrTR_td_folarw' onClick=\"nmdr.core.$('"+e.id+"').expandNode('"+r.id+"');\"><img src='"+n.imagePath+(r.exp?"spArrowd":"spArrowl")+".gif'>":">")+"</td>"),i.push("<td style='width:14px;vertical-align:top'><img src='"+n.imagePath+(r.fol?"spFolder":"spFile")+".gif'></td>"),i.push("<td>"+p[u]+"</td></tr></table></td>")}else{var f=n.showRowCommands&&u==p.length-1?"<a class='nmdrTR_rowcontrol' id='"+e.id+"_nmdrTR_rowcontrol_"+s+"' style='display:none;float:right;'><img src='"+n.imagePath+"spOpen.gif' onclick=\"nmdr.core.$('"+e.id+"').action(event,'open',"+s+");\">&nbsp;<img src='"+n.imagePath+"spEdit.gif' onclick=\"nmdr.core.$('"+e.id+"').action(event,'edit',"+s+");\">&nbsp;<img src='"+n.imagePath+"spDelete.gif' onclick=\"nmdr.core.$('"+e.id+"').action(event,'delete',"+s+');">&nbsp;</a>':"",m=u==p.length-1?'style="width:150px;"':"";i.push("<td class='nmdrTR_td "+m+"'>"+p[u]+f+"</td>")}i.push("</tr>")}if(s++,r.exp)for(var g=0;g<r.childs.length;g++)s=t(i,s,r.childs[g],o+1);return s},i=[];if(i.push("<tbody class='nmdrTR_body'>"),this.treeviewData.length>0)for(var s=0,r=0;r<this.treeviewData.length;r++)s=t(i,s,this.treeviewData[r],0);return this.firstRow=0,this.lastRow=s-1,i.push("</tbody>"),i.join("")},t.updateTable=function(){document.getElementById(this.id+"nmdrTR_content").innerHTML=this.makeTable()},t.expandNode=function(e,t){for(var i=function(e,s){if(s.id===e)return null==t?(s.exp=!s.exp,!0):t&&!s.exp?(s.exp=!0,!0):!(t||!s.exp)&&(s.exp=!1,!0);for(var r=0;r<s.childs.length;r++)if(i(e,s.childs[r]))return!0;return!1},s=0;s<this.treeviewData.length;s++)if(i(e,this.treeviewData[s])){this.clearSelection(),document.getElementById(this.id+"nmdrTR_content").innerHTML=this.makeTable();break}},t.findNodeId=function(e){for(var t=0,i=function(s){if(t===e)return s.id;if(s.exp)for(var r=0;r<s.childs.length;r++){t++;var o=i(s.childs[r]);if(null!==o)return o}return null},s=0;s<this.treeviewData.length;s++){var r=i(this.treeviewData[s]);if(null!==r)return r;t++}return null},t.getAllVisibleNodes=function(){for(var e=0,t=[],i=function(s){if(s.exp)for(var r=0;r<s.childs.length;r++)t.push(e++),i(s.childs[r])},s=0;s<this.treeviewData.length;s++)t.push(e++),i(this.treeviewData[s]);return t},t.selectRow=function(e,t){var i=this.selections.indexOf(t);if(this.props.multiSelection){if(e&&e.ctrlKey)-1===i?this.selections.push(t):(this.selections.splice(i,1),t=-1);else if(e&&e.shiftKey){if(t<this.selections[0])for(r=t;r<this.selections[0];r++)this.selections.push(r);else if(t>this.selections[this.selections.length-1])for(var s=this.selections[this.selections.length-1],r=t;r>s;r--)this.selections.push(r)}else-1===i||this.selections.length>1?(this.selections=[],this.selections[0]=t):(this.selections=[],t=-1);this.selections.sort(function(e,t){return e-t})}else-1===i?this.selections[0]=t:(this.selections=[],t=-1);this.clickedRow=t,this.updateTable(),this.selectionChanged()},t.selectNext=function(){1===this.selections.length&&(this.selections[0]=this.selections[0]==this.lastRow?this.firstRow:this.selections[0]+1,this.clickedRow=this.selections[0],this.updateTable(),this.selectionChanged())},t.selectPrev=function(){1===this.selections.length&&(this.selections[0]=this.selections[0]==this.firstRow?this.lastRow:this.selections[0]-1,this.clickedRow=this.selections[0],this.updateTable(),this.selectionChanged())},t.selectAll=function(){if(this.multiSelection){var e=this.getAllVisibleNodes();this.clickedRow=-1,this.selections=this.selections.length===e.length?[]:e,this.updateTable(),this.selectionChanged()}},t.clearSelection=function(){this.clickedRow=-1,this.selections=[],this.selectionChanged()},t.selectionChanged=function(){for(var e=[],t=0;t<this.selections.length;t++)e.push(this.findNodeId(this.selections[t]));this.handleEvents(e),this.handlePostBack(e)},t.action=function(e,t,i){switch(this.selectRow(e,i),t){case"open":this.openItem(i);break;case"edit":this.editItem(i);break;case"delete":this.deleteItem(i)}},t.updateData=function(e){this.columns=e.cols,this.widths=e.widths?e.widths:[];for(var t=e.data,i=function(e,t,s){for(var r=0;r<e.length;r++)if(e[r].pid==t.id){var o={};o.id=e[r].id,o.pid=e[r].pid,o.fol=e[r].folder,o.sub=!!e[r].sub&&e[r].sub,o.exp=!1,o.dep=s,o.data=e[r].data,o.childs=[],t.childs.push(o),i(e,o,s+1)}},s=0;s<t.length;s++)if(null==t[s].pid){var r={};r.id=t[s].id,r.pid=t[s].pid,r.fol=t[s].folder,r.sub=!!t[s].sub&&t[s].sub,r.exp=!1,r.dep=0,r.data=t[s].data,r.childs=[],i(t,r,1),this.treeviewData.push(r)}this.makeViewer()},t.initEvents=function(){var e=this;document.addEventListener("keydown",function(t){switch(t.keyCode){case 10037:i=e.selections[0];e.expandNode(e.treeviewData[e.selections[0]].id,!1),e.selectRow(null,i),t.preventDefault();break;case 38:e.selectPrev(),t.preventDefault();break;case 10039:var i=e.selections[0];e.expandNode(e.treeviewData[e.selections[0]].id,!0),e.selectRow(null,i),t.preventDefault();break;case 40:e.selectNext(),t.preventDefault()}})},t.handlePostBack=function(e){this.props.doPostBack&&alert(e)},t}