function nmdrTree(e){e=nmdr.core.$(e,"nmdrTree");if(null!=e)return e.props={imagePath:"img/",doPostBack:!1,multiSelection:!1,showRowCommands:!0,lineHeight:"18px",color:"#000000",backColor:"#ffffff",rowSelectionColor:"rgba(156, 206, 240, 0.5)",rowHOverColor:"rgba(205,230,247,0.5)",rowAlternateColor:"rgba(242,246,252,0.5)",checkSelectionColor:"rgb(0,113,198)",showBorder:!0,showShadow:!0,borderColor:"rgb(207,208,210)",borderWidth:"1px",fontStyle:"Arial, Helvetica, sans-serif",fontWidth:"normal",fontSize:"13px",headerColor:"#000000",headerBackColor:"rgb(248, 248, 248)",headerFontStyle:"Arial, Helvetica, sans-serif",headerFontWidth:"bold",headerFontSize:"13px"},e.columns=[],e.widths=[],e.treeviewData=[],e.selections=[],e.menuCommands=[],e.clickedRow=-1,e.firstRow=0,e.lastRow=0,e.rowMenuOpen=!1,e.build=function(e){(e=e||{}).data?(this.props=nmdr.core.utils.mergeProperties(this.props,e),this.updateData(this.props.data)):alert("[nmdrTree]\n\nParameter 'data' does not exist.")},e.headerCellTemplate=function(e,t){return null},e.itemCellTemplate=function(e,t,i,n){return null},e.columnWidthTemplate=function(e){return null},e.handleEvents=function(e){},e.openItem=function(e){alert("open row: "+e)},e.editItem=function(e){alert("edit row: "+e)},e.deleteItem=function(e){alert("delete row: "+e)},e.makeView=function(){var e="#"+this.id,t="<style type='text/css'>"+e+" { position:relative !important; width: 100%; height: 100%; box-sizing: border-box;}"+e+" .nmdrTR_content {  line-height: "+this.props.lineHeight+";  color:"+this.props.color+";  background:"+this.props.backColor+";  font-family: "+this.props.fontStyle+";  font-weight: "+this.props.fontWidth+";  font-size: "+this.props.fontSize+";  border-width:"+(this.props.showBorder?this.props.borderWidth:"0px")+";  border-color:"+this.props.borderColor+";  border-style: solid;  cursor: default;"+(this.props.showShadow?"box-shadow:3px 3px 3px #ccc;":"")+"  user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none;}"+e+" .nmdrTR_table td {   padding-top: 2px;   padding-bottom: 2px;   padding-right: 2px;   padding-left: 2px;}"+e+" .nmdrTR_header {  background: lightgray;  line-height: "+(this.props.lineHeight+8)+";}"+e+" .nmdrTR_header_th {  color: "+this.props.headerColor+";  background: "+this.props.headerBackColor+";  font-family: "+this.props.headerFontStyle+";  font-weight: "+this.headerFontWidth+";  font-size: "+this.props.headerFontSize+";  border-bottom-width:"+(this.props.showBorder?this.props.borderWidth:"0px")+";  border-bottom-color:"+this.props.borderColor+";  border-bottom-style: solid;  padding: 2px;  text-align: left;}"+e+" .nmdrTR_header_th span, img {vertical-align: middle;}"+e+" .nmdrTR_tr:hover {background: "+this.props.rowHOverColor+" !important;}"+e+" .nmdrTR_tr:hover td:first-child {background: "+this.props.rowHOverColor+" !important;}"+e+" .nmdrTR_tr:hover td:first-child span:first-of-type {display:inline !important;}"+e+" .nmdrTR_tr:hover td a.nmdrTR_rowcontrol {display: inline !important; opacity: 0.3 !important;}"+e+" .nmdrTR_tr_sel:hover td a.nmdrTR_rowcontrol {display: inline !important; opacity: 1 !important;}"+e+" .nmdrTR_td_folarw:hover, a.nmdrTR_rowcontrol:hover {cursor:pointer;}"+e+" .nmdrTR_rowMenu { display: none; background-color: white; border: 1px solid #bbb; padding: 5px; width: 200px; line-height: 22px; font-family: arial,verdana,sans-serif; font-weight: normal; font-size:12px; z-index: 999; box-shadow:5px 5px 5px #ddd; transition:all 0.5s ease-in-out;}"+e+" .nmdrTR_rowMenu img { vertical-align: middle; }"+e+" .nmdrTR_rowMenu_tr { height:28px; }"+e+" .nmdrTR_rowMenu_tr:hover { background: "+this.props.rowHOverColor+" !important; cursor: pointer;}</style>",e=[];e.push(t),e.push("<script type='text/javascript'><\/script>"),e.push(this.makeRowMenu(!0)),e.push("<div class='nmdrTR_content' id='"+this.id+"_nmdrTR_content' style='overflow:hidden;'>"+this.makeTable()+"</div>"),this.innerHTML=e.join(""),this.initEvents()},e.makeTable=function(){var e=[],t=0<this.widths.length?" style='table-layout: fixed;'":"";return e.push("<table class='nmdrTR_table' width='100%' border='0' cellpadding='0' cellspacing='0' onselectstart='return false' ondragstart='return false'"+t+">"),e.push(this.makeHeader()),e.push(this.makeBody(!0)),e.push("</table>"),e.join("")},e.makeHeader=function(){var e=[];e.push("<thead class='nmdrTR_header'><tr class='nmdrTR_header_tr'>"),e.push("<th class='nmdrTR_header_th' style='width:20px;text-align:center;'>"),e.push("<img src='"+this.props.imagePath+"spCheck.png' onClick=\"nmdr.core.$('"+this.id+"').selectAll();\"></th>");for(var t=0;t<this.columns.length;t++){var i=this.widths[t],i=i&&!i.endsWith("%")?"style='width:"+i+"'":"";e.push("<th class='nmdrTR_header_th'"+i+"> <span>"+this.columns[t]+"</span></th>")}return e.push("</tr></thead>"),e.join("")},e.makeBody=function(){var m=this,f=function(e,t,i,n){var s=m.props,o=t%2==0,r=t===m.clickedRow,l=-1!==m.selections.indexOf(t),a=l?s.rowSelectionColor:o?s.rowAlternateColor:s.backColor,o=l?s.checkSelectionColor:o?s.rowAlternateColor:s.backColor;e.push("<tr class='nmdrTR_tr"+(r?"_sel":"")+"' onClick=\"nmdr.core.$('"+m.id+"').selectRow(event, "+t+");\" style='background:"+a+" '>"),e.push("<td style='width:20px; text-align:center; background:"+o+"'>"),e.push("<span style='display:"+(l?"inline":"none")+"'>"),e.push("<img src='"+s.imagePath+"spCheck"+(l?"Sel":"")+".png'></span></td>");var d=i.data;if(i.sub)e.push("<td class='nmdrTR_td' colspan="+m.columns.length+" style='text-align:left; background:"+a+"'>"+d[0]+"</td></tr>");else{for(var h=0;h<d.length;h++)if(0==h){e.push("<td class='nmdrTR_td' style='text-align:right;'>"),e.push("<table border='0' cellpadding='0' cellspacing='0' width='100%'><tr>");for(var c=0;c<i.dep;c++)e.push("<td style='width:14px;'></td>");e.push("<td style='width:14px;vertical-align:middle'"+(i.fol?" class='nmdrTR_td_folarw' onClick=\"nmdr.core.$('"+m.id+"').expandNode('"+i.id+"');\"><img src='"+s.imagePath+(i.exp?"spArrowd":"spArrowl")+".gif'>":">")+"</td>"),e.push("<td style='width:14px;vertical-align:top'><img src='"+s.imagePath+(i.fol?"spFolder":"spFile")+".gif'></td>"),e.push("<td id='"+m.id+"_nmdrTR_tdx_"+t+"x"+h+"' param='"+d[h]+"' style='text-align:left;'>"+d[h]+"</td></tr></table></td>")}else{var p=s.showRowCommands&&h==d.length-1?"<a class='nmdrTR_rowcontrol' id='"+m.id+"_nmdrTR_rowcontrol_"+t+"' style='display:none;float:right;'><img src='"+s.imagePath+"spOpen.gif' onclick=\"nmdr.core.$('"+m.id+"').action('open',"+t+");\">&nbsp;<img src='"+s.imagePath+"spEdit.gif' onclick=\"nmdr.core.$('"+m.id+"').action('edit',"+t+");\">&nbsp;<img src='"+s.imagePath+"spDelete.gif' onclick=\"nmdr.core.$('"+m.id+"').action('delete',"+t+');">&nbsp;</a>':"",u=h==d.length-1?' style="width:150px;"':"";e.push("<td class='nmdrTR_td'"+u+" id='"+m.id+"_nmdrTR_tdx_"+t+"x"+h+"' param='"+d[h]+"'>"+d[h]+p+"</td>")}e.push("</tr>")}if(t++,i.exp)for(c=0;c<i.childs.length;c++)t=f(e,t,i.childs[c],n+1);return t},e=[];if(e.push("<tbody class='nmdrTR_body'>"),0<this.treeviewData.length)for(var t=0,i=0;i<this.treeviewData.length;i++)t=f(e,t,this.treeviewData[i],0);return this.firstRow=0,this.lastRow=t-1,e.push("</tbody>"),e.join("")},e.updateTable=function(){document.getElementById(this.id+"_nmdrTR_content").innerHTML=this.makeTable()},e.expandNode=function(e,n){for(var s=function(e,t){if(t.id===e)return null==n?(t.exp=!t.exp,!0):n&&!t.exp?t.exp=!0:!(n||!t.exp)&&!(t.exp=!1);for(var i=0;i<t.childs.length;i++)if(s(e,t.childs[i]))return!0;return!1},t=0;t<this.treeviewData.length;t++)if(s(e,this.treeviewData[t])){this.clearSelection(),document.getElementById(this.id+"_nmdrTR_content").innerHTML=this.makeTable();break}},e.findNodeId=function(n){for(var s=0,o=function(e){if(s===n)return e.id;if(e.exp)for(var t=0;t<e.childs.length;t++){s++;var i=o(e.childs[t]);if(null!==i)return i}return null},e=0;e<this.treeviewData.length;e++){var t=o(this.treeviewData[e]);if(null!==t)return t;s++}return null},e.getAllVisibleNodes=function(){for(var i=0,n=[],s=function(e){if(e.exp)for(var t=0;t<e.childs.length;t++)n.push(i++),s(e.childs[t])},e=0;e<this.treeviewData.length;e++)n.push(i++),s(this.treeviewData[e]);return n},e.selectRow=function(e,t){var i=this.selections.indexOf(t);if(this.props.multiSelection){if(e&&e.ctrlKey)-1===i?this.selections.push(t):(this.selections.splice(i,1),t=-1);else if(e&&e.shiftKey){if(t<this.selections[0])for(var n=t;n<this.selections[0];n++)this.selections.push(n);else if(t>this.selections[this.selections.length-1])for(var s=this.selections[this.selections.length-1],n=t;s<n;n--)this.selections.push(n)}else-1===i||1<this.selections.length?(this.selections=[],this.selections[0]=t):(this.selections=[],t=-1);this.selections.sort(function(e,t){return e-t})}else-1===i?this.selections[0]=t:(this.selections=[],t=-1);this.clickedRow=t,this.updateTable(),this.selectionChanged()},e.selectNext=function(){1===this.selections.length&&(this.selections[0]=this.selections[0]==this.lastRow?this.firstRow:this.selections[0]+1,this.clickedRow=this.selections[0],this.updateTable(),this.selectionChanged())},e.selectPrev=function(){1===this.selections.length&&(this.selections[0]=this.selections[0]==this.firstRow?this.lastRow:this.selections[0]-1,this.clickedRow=this.selections[0],this.updateTable(),this.selectionChanged())},e.selectAll=function(){var e;this.multiSelection&&(e=this.getAllVisibleNodes(),this.clickedRow=-1,this.selections=this.selections.length===e.length?[]:e,this.updateTable(),this.selectionChanged())},e.clearSelection=function(){this.clickedRow=-1,this.selections=[],this.selectionChanged()},e.selectionChanged=function(){for(var e=[],t=0;t<this.selections.length;t++)e.push(this.findNodeId(this.selections[t]));this.handleEvents(e),this.handlePostBack(e)},e.action=function(e,t){switch(e){case"copy":this.copyItem(t);break;case"open":this.openItem(t);break;case"edit":this.editItem(t);break;case"delete":this.deleteItem(t)}},e.updateData=function(e){this.columns=e.cols,this.widths=e.widths||[];for(var t,i=e.data,o=function(e,t,i){for(var n,s=0;s<e.length;s++)e[s].pid==t.id&&((n={}).id=e[s].id,n.pid=e[s].pid,n.fol=e[s].folder,n.sub=e[s].sub||!1,n.exp=!1,n.dep=i,n.data=e[s].data,n.childs=[],t.childs.push(n),o(e,n,i+1))},n=0;n<i.length;n++)null==i[n].pid&&((t={}).id=i[n].id,t.pid=i[n].pid,t.fol=i[n].folder,t.sub=i[n].sub||!1,t.exp=!1,t.dep=0,t.data=i[n].data,t.childs=[],o(i,t,1),this.treeviewData.push(t));this.makeView()},e.initEvents=function(){var i=this;document.getElementById(this.id).oncontextmenu=this.rightClick,document.addEventListener("keydown",function(e){switch(e.keyCode){case 10037:var t=i.selections[0];i.expandNode(i.treeviewData[i.selections[0]].id,!1),i.selectRow(null,t),e.preventDefault();break;case 38:i.selectPrev(),e.preventDefault();break;case 10039:t=i.selections[0];i.expandNode(i.treeviewData[i.selections[0]].id,!0),i.selectRow(null,t),e.preventDefault();break;case 40:i.selectNext(),e.preventDefault()}})},e.rightClick=function(e){e.preventDefault();var t,i=window.pageXOffset||0,n=window.pageYOffset||0,s=document.elementFromPoint(e.pageX-i,e.pageY-n);!s||-1==s.id.indexOf("nmdrTR_tdx_")||2==(t=s.id.substr(s.id.lastIndexOf("_")+1).split("x")).length&&(this.selectRow(e,parseInt(t[0])),s=document.elementFromPoint(e.pageX-i,e.pageY-n),this.openRowMenu(e,parseInt(t[0]),s))},e.handlePostBack=function(e){this.props.doPostBack&&alert(e)},e.makeRowMenu=function(e,t){if(e)return this.menuCommands=this.prepareMenuCommands(),"<div class='nmdrTR_rowMenu' id='"+this.id+"_nmdrTR_rowMenu'></div>";var i=[];i.push("<table cellpadding='0' cellspacing='0' border='0' width='100%' height='100%'>");for(var n=0;n<this.menuCommands.length;n++){var s=this.menuCommands[n];i.push("<tr class='nmdrTR_rowMenu_tr' "),i.push(s.enabled?"onclick=\"nmdr.core.$('"+this.id+"').executeMenuCommand("+n+');">':">"),i.push("<td style='opacity:"+(s.enabled?"1":"0.2")+";width:24px;'><img src='"+this.props.imagePath+s.icon+"'></td>"),i.push("<td style='opacity:"+(s.enabled?"1":"0.2")+";'><span>"+s.name+"</span></td></tr>")}i.push("</table>"),document.getElementById(this.id+"_nmdrTR_rowMenu").innerHTML=i.join("")},e.openRowMenu=function(e,t,i){for(var n in this.menuCommands)this.menuCommands[n].targetRow=t,this.menuCommands[n].param=i?i.getAttribute("param"):"",0==n&&(this.menuCommands[n].enabled=null!=i);this.makeRowMenu(!1,i);var s=this,o=this.getElementsByClassName("nmdrTR_rowMenu")[0],r=this.absPosition,l=i.absPosition;i.getBoundingClientRect();l.left+o.offsetWidth>r.left+this.offsetWidth&&(l.left=this.offsetWidth-o.offsetWidth),o.style.display="inline-block",o.style.position="absolute",o.style.left=l.left-r.left+"px",o.style.top=l.top-r.top+(i?20:14)+"px",nmdr.core.popup.open(o,i,function(){nmdr.core.animate.fadeIn(null,o,null,!0,function(){s.rowMenuOpen=!0})},function(e){s.closeRowMenu(null,s,e)}),nmdr.core.utils.stopPropagation(e)},e.closeRowMenu=function(e,t,i){null==t&&(t=this);var n=t.getElementsByClassName("nmdrTR_rowMenu")[0];nmdr.core.animate.fadeOut(null,n,null,!0,function(){n.style.display="none",t.rowMenuOpen=!1,t.rowMenuActRow=-1,e&&e.action(e.targetRow),i&&i()}),nmdr.core.popup.close()},e.prepareMenuCommands=function(){var t=this;return[{name:"copy content",icon:"copyitem.gif",enabled:!1,targetRow:0,param:"",action:function(e){t.action("copy",e)}},{name:"open item",icon:"details.gif",enabled:!0,targetRow:0,param:"",action:function(e){t.action("open",e)}},{name:"edit item",icon:"editdetails.gif",enabled:!0,targetRow:0,param:"",action:function(e){t.action("edit",e)}},{name:"delete item",icon:"delete.gif",enabled:!0,targetRow:0,param:"",action:function(e){t.action("delete",e)}}]},e.executeMenuCommand=function(e){this.closeRowMenu(this.menuCommands[e])},e.copyItem=function(e){var t=document.getElementsByTagName("body")[0],i=document.createElement("INPUT");t.appendChild(i),i.setAttribute("value",this.menuCommands[0].param),i.select(),i.setSelectionRange(0,99999),document.execCommand("copy"),t.removeChild(i)},e}