function nmdrFavorites(t){var e=nmdr.core.$(t,"nmdrFavorites");if(null!=e)return e.backgroundColor="#fff",e.backgroundImage="teaserbg.png",e.naviButtonColor="#5C6B79",e.menuTitleColor="#5C6B79",e.menuTitleTextColor="#fff",e.menuColor="#fff",e.menuSelectColor="#ACABA9",e.menuTextColor="#000",e.menuSelectTextColor="#fff",e.width=0,e.height=0,e.paddingH=10,e.paddingV=10,e.menuWidth=0,e.naviWidth=45,e.firstMenu=0,e.animation=!1,e.imagePath="",e.menus=[],e.init=function(t,e,i,n){this.width=t,this.height=e,this.imagePath=i,this.menuWidth=Math.round((t-(2*this.naviWidth+6*this.paddingH))/3),this.style.width=t+"px",this.style.height=e+"px",this.style.padding="0px",this.style.bfolder="1px",this.style.bfolderStyle="solid",this.style.bfolderColor="lightgray",this.style.boxShadow="5px 5px 5px #ccc",this.style.backgroundColor=this.backgroundColor,this.backgroundImage&&(this.style.background="url("+this.imagePath+this.backgroundImage+")"),n&&this.readFromXML(n),this.build(),nmdr.core.animate.setData(10,10)},e.build=function(){var t="<style type='text/css'>#"+this.id+" { position:relative !important; }.fav_navigation {background-color:"+this.naviButtonColor+";padding:0px;}.fav_navigation:hover {}#"+this.id+"_fav_navibackward {position:absolute; left:"+this.paddingH+"px; top:"+this.paddingV+"px; width:"+this.naviWidth+"px; height:"+(this.height-2*this.paddingV)+"px;}#"+this.id+"_fav_naviforward {position:absolute; left:"+(3*this.menuWidth+this.naviWidth+5*this.paddingH)+"px; top:"+this.paddingV+"px; width:"+this.naviWidth+"px; height:"+(this.height-2*this.paddingV)+"px;}#"+this.id+'_fav_swprev_img {width:12px; height:23px; position:absolute; top:50%; left:50%; margin-left:-6px; margin-top:-12px; background-position: -178px -3px; background-image: url("'+this.imagePath+'favoritenSprite.png");}#'+this.id+'_fav_swnext_img {width:12px; height:23px; position:absolute; top:50%; left:50%; margin-left:-6px; margin-top:-12px; background-position: -165px -3px; background-image: url("'+this.imagePath+'favoritenSprite.png");}.fav_area {overflow:hidden; position:absolute; padding:0px;}#'+this.id+"_fav_area {left:"+(this.naviWidth+2*this.paddingH)+"px; top:"+this.paddingV+"px; width:"+(this.width-2*this.naviWidth-4*this.paddingH)+"px; height:"+(this.height-2*this.paddingV)+"px;}.fav_view {position:absolute; left:0px; top:0px;}.fav_menu: {}.fav_menu_header {height:26px;vertical-align:middle;text-align:left; padding:0px 5px 0px 5px;font-family:arial,Helvetica,sans-serif;font-size:13px;font-style:normal;font-weight:bold;border-bottom:1px solid black;background:"+this.menuTitleColor+";color:"+this.menuTitleTextColor+";}.fav_menu_header_title {line-height:26px; height:26px; display:inline;}.fav_menu_header_control {margin-top:4px;line-height:26px; width:18px; height:18px; display:inline; float:right;background-position: -5px -35px; background-image: url('"+this.imagePath+"favoritenSprite.png');}.fav_menu_header_control:hover {cursor:pointer; background-position: -35px -35px; background-image: url('"+this.imagePath+"favoritenSprite.png');}.fav_menu_content {position:absolute; left:0px top:20x; width:100%; display:inline; padding:1px 0px 1px 0px;height:"+(this.height-2*this.paddingV-28)+"px ;overflow-y:auto; background:"+this.menuColor+";}.fav_menu_item {color:"+this.menuTextColor+";height:24px;vertical-align:middle;text-align:left;padding:0px 5px 0px 5px; font-family:arial,Helvetica,sans-serif;font-size:12px;font-style:normal;font-weight:normal;}.fav_menu_item:hover {background:"+this.menuSelectColor+";color:"+this.menuSelectTextColor+';}.fav_item_title_folder {cursor:pointer;line-height:20px;vertical-align:middle;}.fav_item_title_link {cursor:pointer;line-height:20px;vertical-align:middle;}.fav_item_title_link:hover {color:blue;}.fav_item_title_arrow_blank {line-height:20px;background-position: -240px -5px; background-image: url("'+this.imagePath+"favoritenSprite.png\");}.fav_item_title_arrow_open {cursor:pointer;line-height:20px;vertical-align:middle;background-position: -185px -305px; background-image: url('"+this.imagePath+"favoritenSprite.png');}.fav_item_title_arrow_close {cursor:pointer;line-height:20px;vertical-align:middle;background-position: -185px -335px; background-image: url('"+this.imagePath+"favoritenSprite.png');}.fav_item_control1 {background-position: -35px -65px; background-image: url('"+this.imagePath+"favoritenSprite.png');}.fav_item_control2 {background-position: -35px -95px; background-image: url('"+this.imagePath+"favoritenSprite.png');}.fav_item_control1:hover {cursor:pointer; background-color:white;background-position: -185px -65px; background-image: url('"+this.imagePath+"favoritenSprite.png');}.fav_item_control2:hover {cursor:pointer; background-color:white;background-position: -185px -95px; background-image: url('"+this.imagePath+"favoritenSprite.png');}#fav_ctrl_menupopup {z-index:999 !important;display:none;position:absolute; top:0px; left:0px; width:180px; padding:5px 2px 5px 2px; background:#eee;bfolder:1px; bfolder-style:solid; bfolder-color:black; box-shadow:3px 3px 3px #ccc;}.fav_ctrl_menuitem {height:24px;vertical-align:middle;text-align:left;font-family:arial,Helvetica,sans-serif;font-size:13px;font-style:normal;font-weight:normal;}.fav_ctrl_menuitem:hover {cursor:pointer; background:#5C6B79;color:white;}.fav_ctrl_menuitem_img {height:20px;width:20px;vertical-align:middle;float:left;}.fav_ctrl_menuitem_text {height:20px;vertical-align:middle;padding:4px 0px 0px 25px;}</style>",e=0!=this.firstMenu,i=this.firstMenu<this.menus.length-3,n="<div class='fav_navigation' id='"+this.id+"_fav_navibackward' "+(e?'onmouseover="this.style.cursor=\'pointer\';this.style.opacity=0.5;" onmouseout="this.style.opacity=1;" onclick="nmdr.core.$(\''+this.id+"').goBackward();\"><div id='"+this.id+"_fav_swprev_img'></div>":">")+"</div>",a="<div class='fav_navigation' id='"+this.id+"_fav_naviforward' "+(i?'onmouseover="this.style.cursor=\'pointer\';this.style.opacity=0.5;" onmouseout="this.style.opacity=1;" onclick="nmdr.core.$(\''+this.id+"').goForward();\"><div id='"+this.id+"_fav_swnext_img'></div>":">")+"</div>",r=[];r.push(t),r.push(this.makeControlMenu()),r.push(n),r.push(this.createMenus()),r.push(a),this.innerHTML=r.join("")},e.createMenus=function(){var t=[],e=0;t.push("<div class='fav_area' id='"+this.id+"_fav_area'><div class='fav_view'>");for(var i=0;i<this.menus.length;i++)if(i>=this.firstMenu&&i<=this.firstMenu+2){var n=this.menus[i].key;t.push("<div class='fav_menu' id='"+this.id+"_"+n+"' style='position:absolute; left:"+e+"px; top:0px; width:"+this.menuWidth+"px; height:"+(this.height-2*this.paddingV)+"px; text-align:left;'>"),t.push("<div class='fav_menu_header'>"),t.push("<span class='fav_menu_header_title'>"+n+"</span>"),t.push("<span class='fav_menu_header_control' id='"+this.id+"_"+n+"_menuCtrl' onclick=\"nmdr.core.$('"+this.id+"').openCtrlPopup(this);\"></span></div>"),t.push("<div class='fav_menu_content' id='"+this.id+"_"+n+"_content'>"),t.push(this.createMenuContent(n)),t.push("</div></div>"),e+=this.menuWidth+this.paddingH}return t.push("</div></div>"),t.join("")},e.createMenuContent=function(t){var e=[];e.push("<table border='0', cellpadding='0', cellspacing='0', width=100%>");var i=this.getMenu(t).items;for(var n in i)this.createItem(e,i[n],5);return e.push("</table>"),e.join("")},e.createItem=function(t,e,i){if(t.push("<tr><td class='fav_menu_item' onmouseover=\"nmdr.core.$('"+this.id+"').showItemControls(this, true);\" onmouseout=\"nmdr.core.$('"+this.id+"').showItemControls(this, false);\" style='padding-left:"+i+"px;'><span class='fav_item_title_arrow_"+(e.folder?e.expanded?"close":"open":"blank")+"' style='width:22px; height:20px; float:left;' "+(e.folder?"onclick=\"nmdr.core.$('"+this.id+"').expandNode('"+e.id+"');\"":"")+"></span><span class='fav_item_title_"+(e.folder?"folder":"link")+"' onclick=\"nmdr.core.$('"+this.id+"')."+(e.folder?"expandNode('"+e.id+"')":"startLink('"+e.url+"')")+';">'+e.title+"</span><span id='"+e.id+"_delete' class='fav_item_control2' style='width:20px; height:20px; float:right; display:none;' onclick=\"nmdr.core.$('"+this.id+"').itemControl(event);\"></span><span id='"+e.id+"_edit' class='fav_item_control1' style='width:20px; height:20px; float:right; display:none;' onclick=\"nmdr.core.$('"+this.id+"').itemControl(event);\"></span></td></tr>"),e.expanded)for(var n in e.childs)this.createItem(t,e.childs[n],i+12)},e.goBackward=function(){if(!this.animation){this.animation=!0,this.menus[this.firstMenu+2]&&nmdr.core.animate.fadeOut(this.id+"_"+this.menus[this.firstMenu+2].key,null,.05);var t=this.getElementsByClassName("fav_view")[0];nmdr.core.animate.move(null,t,Math.round(t.offsetLeft+this.menuWidth+this.paddingH),t.offsetTop,function(t){t.firstMenu--,t.build(),t.animation=!1},this)}},e.goForward=function(){if(!this.animation){this.animation=!0;var t=this.getElementsByClassName("fav_view")[0];nmdr.core.animate.fadeOut(this.id+"_"+this.menus[this.firstMenu].key,null,.05),nmdr.core.animate.move(null,t,Math.round(t.offsetLeft-this.menuWidth-this.paddingH),t.offsetTop,function(t){t.firstMenu++,t.build(),t.animation=!1},this)}},e.readFromXML=function(t){var e=this,i=function(t,n,a){var r=t||e.addMenu(a.attributes.id),l=t?e.addItem(t,n,a.attributes.title,a.attributes.url,!1):null;for(var o in a.childNodes)if(a.childNodes[o].name){var s=a.childNodes[o].name.toLowerCase();"item"!=s&&"menuitem"!=s||i(r,l,a.childNodes[o])}},n=nmdr.core.xml.read(t,"menus");for(var a in n.childNodes)n.childNodes[a].name&&i(null,null,n.childNodes[a])},e.addMenu=function(t){var e=this.getMenu(t);return null==e&&(e={key:t,items:[]},this.menus.push(e)),e},e.addItem=function(t,e,i,n,a){var r="";e?r=e.id+"_"+e.childs.length:null!=this.getMenu(t.key)&&(r=this.id+"_"+t.key+"#"+t.items.length);var l={id:r,title:i,url:n,childs:[],folder:a,expanded:!1};return e?(e.folder=!0,e.childs.push(l)):t.items.push(l),l},e.getMenu=function(t){for(var e in this.menus)if(this.menus[e].key==t)return this.menus[e];return null},e.removeMenu=function(t){for(var e=0;e<this.menus.length;e++)if(this.menus[e].key==t){this.menus.splice(e,1);break}},e.renameMenu=function(t,e){var i=this,n=this.getMenu(t),a=function(t,e){for(var r in e){var l=e[r];l.id=t?t.id+"_"+r:i.id+"_"+n.key+"#"+r,l.folder&&a(l,l.childs)}};n.key=e,a(null,n.items)},e.getItem=function(t){var e=function(t,i){for(var n in i){var a=i[n];if(a.id==t)return a;if(a.folder){var r=e(t,a.childs);if(null!=r)return r}}return null};for(var i in this.menus){var n=e(t,this.menus[i].items);if(n)return n}return null},e.removeItem=function(t){var e=t.indexOf("#"),i=t.substring(0,e),n=i.substring(t.indexOf("_")+1,i.length),a=this.getMenu(n),r=function(e){for(var i in e){if(e[i].id==t)return e.splice(i,1),!0;if(e[i].folder&&r(e[i].childs))return!0}return!1},l=function(t,e){for(var i in e){var n=e[i];n.id=t?t.id+"_"+i:self.id+"_"+a.key+"#"+i,n.folder&&l(n,n.childs)}};r(a.items)&&l(null,a.items)},e.renameItem=function(t,e,i){if(e.length>0&&i.length>0){var n=item=this.getItem(t);n&&(n.title=e,n.url=i)}},e.expandFolder=function(t){var e=function(t,i){for(var n in i){var a=i[n];if(a.folder){if(a.id==t)return a.expanded=!0,!0;if(e(t,a.childs))return a.expanded=!0,!0}}return!1};for(var i in this.menus)if(e(t,this.menus[i].items))return!0;return!1},e.getFolders=function(t,e,i,n){var a=[];null!=i?a=i.childs:(null==t&&(t=this.getMenu(e)),a=t.items);var r=[];for(var l in a)if(a[l].folder){var o=(n?n+"/":"")+a[l].title;r.push({name:o,id:a[l].id}),r=r.concat(this.getFolders(null,null,a[l],o))}return r},e.getItem=function(t){var e=function(t,i){if(t.id==i)return t;for(var n in t.childs){var a=e(t.childs[n],i);if(a)return a}};for(var i in this.menus){var n=this.menus[i].items;for(var a in n){var r=e(n[a],t);if(r)return r}}return null},e.startLink=function(t){alert("start-link: "+t)},e.itemControl=function(t){var e=(t=t||window.event).target||t.srcElement;-1!=e.id.indexOf("delete")?this.deleteItemX(e.id):-1!=e.id.indexOf("edit")?this.editItemX(e.id):alert("action "+e.id)},e.showItemControls=function(t,e){t.getElementsByClassName("fav_item_control1")[0].style.display=e?"inline":"none",t.getElementsByClassName("fav_item_control2")[0].style.display=e?"inline":"none"},e.expandNode=function(t){var e=this.getItem(t);if(e){e.expanded=!e.expanded;var i=t.substring(0,t.indexOf("#"));document.getElementById(i+"_content").innerHTML=this.createMenuContent(i.substring(i.indexOf("_")+1,i.length))}},e.makeControlMenu=function(){var t=[];t.push("<div id='fav_ctrl_menupopup'>"),t.push("<table border='0', cellpadding='0', cellspacing='0', width=100%>");for(var e=0;e<6;e++)t.push("<tr><td class='fav_ctrl_menuitem' "),t.push("onmouseover=\"nmdr.core.$('"+this.id+"').showCtrlMenuItem(this,"+e+',true);" '),t.push("onmouseout=\"nmdr.core.$('"+this.id+"').showCtrlMenuItem(this,"+e+',false);">'),t.push("<div class='fav_ctrl_menuitem_img' onclick=\"nmdr.core.$('"+this.id+"').ctrlActionPerformed(this);\" style='"+this.getCtrlMenuItemImage(e,!1)+"'></div>"),t.push("<div class='fav_ctrl_menuitem_text' onclick=\"nmdr.core.$('"+this.id+"').ctrlActionPerformed(this);\">"+this.getCtrlMenuItemText(e)+"</div>"),t.push("</td></tr>");return t.push("</table></div>"),t.join("")},e.openCtrlPopup=function(t){var e=this,i=nmdr.core.utils.positionOld(t,this),n=document.getElementById("fav_ctrl_menupopup");nmdr.core.popup.open(n,t,null,function(t){e.closeCtrlPopup(t)});for(var a=n.getElementsByClassName("fav_ctrl_menuitem_img"),r=n.getElementsByClassName("fav_ctrl_menuitem_text"),l=0;l<a.length;l++)a[l].id=t.id+"#"+l;for(l=0;l<r.length;l++)r[l].id=t.id+"#"+l;n.style.display="inline-block",n.style.top=i.top+20+"px",n.style.left=i.left-n.offsetWidth+t.offsetWidth+"px"},e.closeCtrlPopup=function(t){var e=document.getElementById("fav_ctrl_menupopup");e.style.display="none",e.style.top="0px",e.style.left="0px",nmdr.core.popup.close(),t&&t()},e.ctrlActionPerformed=function(t){switch(this.closeCtrlPopup(),t.id.substring(t.id.indexOf("#")+1,t.id.length)){case"0":this.addNewMenuX(t.id);break;case"1":this.addNewItemX(t.id,!0);break;case"2":this.addNewItemX(t.id,!1);break;case"3":this.deleteMenuX(t.id);break;case"4":this.renameMenuX(t.id)}},e.showCtrlMenuItem=function(t,e,i){t.getElementsByClassName("fav_ctrl_menuitem_img")[0].style.backgroundPosition=this.getCtrlMenuItemImagePos(e,i)},e.getCtrlMenuItemImage=function(t,e){return"background-position: "+this.getCtrlMenuItemImagePos(t,e)+'background-image: url("'+this.imagePath+'favoritenSprite.png");'},e.getCtrlMenuItemImagePos=function(t,e){switch(t){case 0:return e?"-35px -215px;":"-185px -215px;";case 1:return e?"-35px -245px;":"-185px -245px;";case 2:return e?"-35px -275px;":"-185px -275px;";case 3:return e?"-35px -95px;":"-185px -95px;";case 4:return e?"-35px -65px;":"-185px -65px;";case 5:return e?"-35px -155px;":"-185px -155px;";default:return""}},e.getCtrlMenuItemText=function(t){switch(t){case 0:return"Create new menu";case 1:return"Create new folder";case 2:return"Create new link";case 3:return"Delete menu";case 4:return"Rename menu";case 5:return"Sort items";default:return""}},e.addNewMenuX=function(t){var e=this;nmdr.core.dialog.dialog({title:"Adding new menu",message:"<table cellpadding='2' cellspacing='10'´><tr><td>Name :</td><td><input type='text' name='menu_name' id='menu_name' style='width:300px;height:22px;'></td></tr></table>",width:400,height:200,buttons:[{lable:"Cancel",callback:function(){}},{lable:"Save",callback:function(){var i=document.getElementById("menu_name").value,n=t.substring(t.indexOf("_")+1,t.length);n=n.substring(0,n.indexOf("_"));for(var a=0;a<e.menus.length;a++)if(e.menus[a].key==n){e.menus.splice(a+1,0,{key:i,items:[]});break}e.build()}}]})},e.addNewItemX=function(t,e){var i=t.substring(t.indexOf("_")+1,t.length);i=i.substring(0,i.indexOf("_"));var n=this.getFolders(null,i,null,null),a="<option value=''></option>";for(var r in n)a+="<option value='"+n[r].id+"'>"+n[r].name+"</option>";var l=this,o="<table cellpadding='2' cellspacing='10'><tr><td>Folders:</td><td><select name='enty_folder' id='enty_folder' style='width:300px;height:22px;'>"+a+"</select></td></tr><tr><td>Title:</td><td><input type='text' name='enty_title' id='enty_title' style='width:300px;height:22px;'></td></tr><tr><td>Link:</td><td><input type='text' name='entry_link' id='entry_link' style='width:300px;height:22px;'></td></tr></table>";nmdr.core.dialog.dialog({title:"Adding new "+(e?"folder":"item"),message:o,width:400,height:200,buttons:[{lable:"Cancel",callback:null},{lable:"Save",callback:function(){for(var t=document.getElementById("enty_folder").value,n=document.getElementById("enty_title").value,a=document.getElementById("entry_link").value,r=0;r<l.menus.length;r++)if(l.menus[r].key==i){l.addItem(l.menus[r],l.getItem(t),n,a,e);break}l.expandFolder(t),l.build()}}]})},e.deleteMenuX=function(t){var e=this,i=t.substring(0,t.lastIndexOf("_")),n=i.substring(t.indexOf("_")+1,i.length);nmdr.core.dialog.confirm("Deleting menu..","Are you sure to delete the menu '"+n+"' ?",function(t){t&&nmdr.core.animate.fadeOut(i,null,.05,!0,function(t){e.removeMenu(n),0==e.menus.length&&e.addMenu("New menu"),e.build()})})},e.renameMenuX=function(t){var e=this,i=t.substring(t.indexOf("_")+1,t.length);i=i.substring(0,i.indexOf("_"));nmdr.core.dialog.dialog({title:"Renaming menu",message:"<table cellpadding='2' cellspacing='10'><tr><td>Name:</td><td><input type='text' name='entry_name' id='entry_name' style='width:300px;height:22px;'></td></tr></table>",width:400,height:200,buttons:[{lable:"Cancel",callback:null},{lable:"Rename",callback:function(){e.renameMenu(i,document.getElementById("entry_name").value),e.build()}}]})},e.deleteItemX=function(t){var e=this,i=t.substring(0,t.lastIndexOf("_")),n=this.getItem(i);nmdr.core.dialog.confirm("Deleting item..","Are you sure to delete the item '"+n.title+"' ?",function(t){t&&(e.removeItem(i),e.build())})},e.editItemX=function(t){var e=this,i=t.substring(0,t.lastIndexOf("_")),n=this.getItem(i),a="<table cellpadding='2' cellspacing='10'><tr><td>Title:</td><td><input type='text' name='enty_title' id='enty_title' value='"+n.title+"' style='width: 300px'></td></tr><tr><td>Link:</td><td><input type='text' name='entry_link' id='entry_link' value='"+n.url+"' style='width: 300px'></td></tr></table>";nmdr.core.dialog.dialog({title:"Editing item",message:a,width:400,height:200,buttons:[{lable:"Cancel",callback:null},{lable:"Save",callback:function(){var t=document.getElementById("enty_title").value,n=document.getElementById("entry_link").value;e.renameItem(i,t,n),e.build()}}]})},e}