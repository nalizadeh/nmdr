function nmdrCommands(t){var e=nmdr.core.$(t,"nmdrCommands");if(null!=e)return e.imagePath="img/",e.lang="en",e.color="#666",e.background="#F7F3F7",e.backgroundImage="ribbonBackground.png",e.font="normal 11px 'Segoe UI',Tahoma,Verdana,sans-serif",e.buttonWidth=62,e.isMenuOpen=!1,e.isComboOpen=!1,e.selectedButton=null,e.commands=null,e.commandsHash={},e.commandsPool={},e.preCheckMethod=null,e.postCheckMethod=null,e.checkIsPerforming=null,e.build=function(t,e,i,o,n){null==t&&(t=this.prepareTestCommands()),o&&(this.lang=o),n&&(this.imagePath=n+"/"),this.preCheckMethod=e,this.postCheckMethod=i,this.commandsHash={},this.commandsPool={},this.readFromXML(t);for(var s=0;s<this.commands.groups.length;s++)for(var d=this.commands.groups[s],a=0;a<d.buttons.length;a++)this.commandsHash[d.buttons[a].id]=null;var r=[],l="#"+this.id+"_nmdrCommands",c="<style>#"+this.id+" { position:relative !important; }"+l+" { position:absolute; left:0px; top:0px; width:100%; height:90px; margin:0; padding:0; vertical-align:top; display:inline-block; font:"+this.font+"; font-size:11px; color:#23272c; line-height:1em;border-top:none; border-bottom:1px solid transparent; background-image:url("+this.imagePath+this.backgroundImage+") !important;background-repeat:no-repeat; background:#fff; -webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none; }"+l+" .groupDiv { vertical-align:top; padding:2px 4px 0px 4px; height:88px; border-right:1px solid #ccc; }"+l+" .buttonDiv { vertical-align:top; padding:4px 0px 0px 0px; height:68px; overflow:hidden; border:1px solid transparent; }"+l+" .buttonDivtd { text-align:center; vertical-align:top; text-overflow:ellipsis; white-space:normal; }"+l+" .buttonDiv:hover { cursor:pointer; border:1px solid orange; background-image:url("+this.imagePath+"ribbonButtonHover.png) !important;background-repeat:repeat; }"+l+" .smallbuttonsDiv { vertical-align:top; padding:4px 0px 0px 0px; height:68px; overflow:hidden; border:1px solid transparent; }"+l+" .smallbuttonDiv { height:20px; padding:2px 2px 0px 2px;}"+l+" .smallbuttonDiv:hover { cursor:pointer; background-image:url("+this.imagePath+"ribbonButtonHover.png) !important;background-repeat:repeat; }"+l+" .checkboxesDiv { vertical-align:top; padding:4px 0px 0px 0px; height:68px; overflow:hidden; border:1px solid transparent; }"+l+" .checkboxDiv { padding:0px 2px 0px 2px; }"+l+" .checkboxDiv:hover { cursor:pointer; background-image:url("+this.imagePath+"ribbonMItemHover.png) !important;background-repeat:repeat; }"+l+" .radiobuttonsDiv { vertical-align:top; padding:4px 0px 0px 0px; height:68px; overflow:hidden; border:1px solid transparent; }"+l+" .radiobuttonDiv { padding:0px 2px 0px 2px; }"+l+" .radiobuttonDiv:hover { cursor:pointer; background-image:url("+this.imagePath+"ribbonMItemHover.png) !important;background-repeat:repeat; }"+l+" .comboboxesDiv { vertical-align:top; padding:4px 0px 0px 0px; height:68px; overflow:hidden; border:1px solid transparent; }"+l+" .comboboxDiv { padding:0px 2px 0px 2px; border:1px solid #ccc; background:#fff; }"+l+" .comboboxDiv:hover { cursor:pointer; border:1px solid orange; }"+l+" .comboitemDiv:hover { cursor:pointer;  background-image:url("+this.imagePath+"ribbonMItemHover.png) !important;background-repeat:repeat; }"+l+" .menuitemDiv:hover { cursor:pointer; background-image:url("+this.imagePath+"ribbonMItemHover.png) !important;background-repeat:repeat; }"+l+" .groupnameDiv { height:16px; text-align:center; font-size:11px; color:#666; }"+l+" .itemDisabled { opacity:0.5; cursor:default !important;}"+l+" .popupDiv { background:#fff;padding:4px;border:1px solid #ccc;font-size:11px; z-index:999;}</style>";return r.push("<div id='"+this.id+"_nmdrCommands' style='display:inline-block;'>"),r.push("<div id='"+this.id+"_nmdrCommands_popup' class='popupDiv' style='position:absolute;left:0px;top:0px;width:0px;height:0px;display:none;'></div>"),r.push("<div id='"+this.id+"_nmdrCommands_sizeCalculator' style='position:absolute;top:0px;left:0px;visibility:hidden;'></div>"),r.push("</div>"),this.innerHTML=c+r.join(""),this.createContent(),this},e.getItem=function(t){for(var e=function(t,e){for(var i=0;i<e.length;i++)if(e[i].id==t)return e[i]},i=this.commands.groups,o=null,n=0;n<i.length&&null==(o=e(t,i[n].buttons))&&null==(o=e(t,i[n].checkboxes))&&null==(o=e(t,i[n].radiobuttons))&&null==(o=e(t,i[n].comboboxes));n++);return o},e.actionPerformed=function(t){alert("You started command: "+t)},e.executeCommand=function(t,e){var i=this;if(!this.closePopups(function(){i.executeCommand(t,e)})){var o=this.getItem(e);null!=o&&(o.menu.length>0?this.openMenu(t,o):this.actionPerformed(o.command))}},e.executeMenuCommand=function(t,e){var i=this;this.closeMenu(function(){i.actionPerformed(e)})},e.toggleCheckBox=function(t){var e=this;if(!this.closePopups(function(){e.toggleCheckBox(t)})){var i=this.getItem(t);i.checked=!i.checked;var o=this.imagePath+(i.checked?"/checkboxon.png":"/checkboxoff.png");document.getElementById(this.id+"_nmdrCommands_checkboxDiv_"+t+"_img").src=o,i.command&&this.actionPerformed(i.command)}},e.selectRadioButton=function(t,e){var i=this;if(!this.closePopups(function(){i.selectRadioButton(t,e)})){for(var o=this.getItem(t),n=null,s=0;s<o.radiobuttons.length;s++){var d=o.radiobuttons[s];d.selected=d.id==e;var a=this.imagePath+(d.selected?"/radiobutton.png":"/radiobuttoff.png");document.getElementById(this.id+"_nmdrCommands_radiobuttonDiv_"+d.id+"_img").src=a,d.selected&&(n=d)}n&&n.command&&this.actionPerformed(n.command)}},e.selectComboBox=function(t,e){var i=this,o=this.getItem(t);o.selected=e,document.getElementById(this.id+"_nmdrCommands_comboboxDiv_"+o.id+"_input").innerHTML=e,this.closeComboBox(function(){i.actionPerformed(o.command)})},e.openMenu=function(t,e){var i=this;if(!this.closePopups(function(){i.openMenu(t,e)})){this.isMenuOpen=!0;for(var o=[],n=0;n<e.menu.length;n++){var s=e.menu[n];o.push("<div class='menuitemDiv' style='display:block;' onclick=\"nmdr.core.$('"+this.id+"').executeMenuCommand(event,'"+s.command+"');\"><table cellpadding='2' cellspacing='0' border='0'><tr><td><img src='"+s.image+"' title='"+s.tooltip+"'></td><td style='vertical-align:middle;'><span style='font-size:12px;font-weight:bold;'>"+s.text+"</span><br><span style='font-size:11px;font-weight:normal;'>"+s.description+"</span></td></tr></table></div>")}this.selectedButton=this.id+"_nmdrCommands_buttonDiv_"+e.id;var d=document.getElementById(this.id+"_nmdrCommands_popup"),a=document.getElementById(this.selectedButton),r=document.getElementById(this.id+"_nmdrCommands_sizeCalculator"),l=this.absPosition,c=a.absPosition,m=o.join("");r.innerHTML=m,d.innerHTML=m,a.style.background="url("+this.imagePath+"ribbonButtonHover.png)",d.style.display="inline-block",d.style.top=c.top-l.top+a.offsetHeight+"px",d.style.left=c.left-l.left+"px",d.style.width=r.offsetWidth+4+"px",d.style.height=r.offsetHeight+"px",d.style.opacity=0,r.innerHTML="",nmdr.core.popup.open(d,t.target,null,function(t){i.closeMenu(t)}),nmdr.core.animate.fadeIn(null,d,null,!0),nmdr.core.utils.stopPropagation(t)}},e.closeMenu=function(t){if(this.isMenuOpen){this.isMenuOpen=!1;var e=document.getElementById(this.id+"_nmdrCommands_popup"),i=document.getElementById(this.selectedButton);nmdr.core.animate.fadeOut(null,e,null,!0,function(){e.style.display="none",e.style.top="0px",e.style.left="0px",e.style.width="0px",e.style.height="0px",i.style.background="transparent",t&&t()}),nmdr.core.popup.close()}},e.openComboBox=function(t,e){var i=this;if(!this.closePopups(function(){i.openComboBox(t,e)})){this.isComboOpen=!0;for(var o=[],n=this.getItem(e),s=0;s<n.items.length;s++){var d=n.items[s];o.push("<div class='comboitemDiv' style='display:block;' onclick=\"nmdr.core.$('"+this.id+"').selectComboBox('"+e+"','"+d+"');\"><table cellpadding='2' cellspacing='0' border='0'><tr><td style='vertical-align:middle;'>"+d+"</td></tr></table></div>")}var a=document.getElementById(this.id+"_nmdrCommands_popup"),r=document.getElementById(this.id+"_nmdrCommands_comboboxDiv_"+e),l=document.getElementById(this.id+"_nmdrCommands_sizeCalculator"),c=this.absPosition,m=r.absPosition,p=o.join("");l.innerHTML=p,a.innerHTML=p,a.style.display="inline-block",a.style.top=m.top-c.top+r.offsetHeight+"px",a.style.left=m.left-c.left+"px",a.style.width=(l.offsetWidth<n.width?n.width-4:l.offsetWidth)+"px",a.style.height=l.offsetHeight+"px",l.innerHTML="",nmdr.core.popup.open(a,t.target,null,function(t){i.closeComboBox(t)}),nmdr.core.animate.fadeIn(null,a,null,!0),nmdr.core.utils.stopPropagation(t)}},e.closeComboBox=function(t){if(this.isComboOpen){this.isComboOpen=!1;var e=document.getElementById(this.id+"_nmdrCommands_popup");nmdr.core.animate.fadeOut(null,e,null,!0,function(){e.style.display="none",e.style.top="0px",e.style.left="0px",e.style.width="0px",e.style.height="0px",t&&t()}),nmdr.core.popup.close()}},e.closePopups=function(t){return this.isMenuOpen?(this.closeMenu(t),!0):!!this.isComboOpen&&(this.closeComboBox(t),!0)},e.canDO=function(t){if(null==this.commandsHash[t])this.commandsPool[t]="X",this.doCheck();else{var e=this.getItem(t);e&&(e.enabled=this.commandsHash[t]),this.commandsHash[t]=null}},e.doCheck=function(){if(null==this.checkIsPerforming&&Object.keys(this.commandsPool).length==Object.keys(this.commandsHash).length){this.checkIsPerforming=!0;for(var t in this.commandsHash)this.commandsHash[t]=!1;var e=this;this.preCheckMethod(function(){e.postCheckMethod(e.commandsHash),e.checkIsPerforming=null,e.commandsPool={},e.checkCommands(),e.createContent()})}},e.checkCommands=function(){for(var t=0;t<this.commands.groups.length;t++)for(var e=this.commands.groups[t],i=0;i<e.buttons.length;i++)this.canDO(e.buttons[i].id)},e.createContent=function(){for(var t=[],e=0;e<this.commands.groups.length;e++){var i=this.commands.groups[e],o=[];t.push("<div class='groupDiv' style='display:inline-block;'>");for(c=0;c<i.buttons.length;c++)if("16"!=(n=i.buttons[c]).size){s="";n.menu&&n.menu.length>0&&(s="<br><img src='"+this.imagePath+"/menuf.png'>"),t.push("<div class='buttonDiv"+(n.enabled?"'":" itemDisabled'")+"id='"+this.id+"_nmdrCommands_buttonDiv_"+n.id+"' style='display:inline-block;'"+(n.enabled?" onclick=\"nmdr.core.$('"+this.id+"').executeCommand(event, '"+n.id+"');\"":"")+"><table cellpadding='2' cellspacing='0' border='0'><tr><td class='buttonDivtd' style='width:"+n.width+"px;'><img src='"+n.image+"' title='"+n.tooltip+"'></td></tr><tr><td class='buttonDivtd' style='width:"+n.width+"px;'>"+n.text+s+"</td></tr></table></div>")}else o.push(n);if(o.length>0){l=0;do{t.push("<div class='smallbuttonsDiv' style='display:inline-block;'>");for(c=0;l<o.length&&!(c>0&&c%3==0);c++,l++){var n=o[l],s="";n.menu&&n.menu.length>0&&(s="&nbsp;<img src='"+this.imagePath+"/menuf.png' onclick=\"nmdr.core.$('"+this.id+"').openMenu(event, "+nr+');">'),t.push("<div class='smallbuttonDiv"+(n.enabled?"'":" itemDisabled'")+" id='"+this.id+"_nmdrCommands_buttonDiv_"+n.id+"' style='display:block;' "+(n.enabled?"onclick=\"nmdr.core.$('"+this.id+"').executeCommand(event, '"+n.id+"');\"":"")+"><table cellpadding='1' cellspacing='0' border='0'><tr><td><img src='"+n.image+"' title='"+n.tooltip+"'></td><td style='vertical-align:middle;'><span>"+n.text+s+"</span></td></tr></table></div>")}t.push("</div>")}while(l<o.length)}if(i.checkboxes.length>0){l=0;do{t.push("<div class='checkboxesDiv' style='display:inline-block;'>");for(c=0;l<i.checkboxes.length&&!(c>0&&c%3==0);c++,l++){var d=i.checkboxes[l],a=this.imagePath+(d.checked?"/checkboxon.png":"/checkboxoff.png");t.push("<div class='checkboxDiv"+(d.enabled?"'":" itemDisabled'")+" id='"+this.id+"_nmdrCommands_checkboxDiv_"+d.id+"' style='display:block;' "+(d.enabled?"onclick=\"nmdr.core.$('"+this.id+"').toggleCheckBox('"+d.id+"');\"":"")+"><table cellpadding='1' cellspacing='0' border='0'><tr><td style='vertical-align:middle;'><img id='"+this.id+"_nmdrCommands_checkboxDiv_"+d.id+"_img' src='"+a+"' title='"+d.tooltip+"'></td><td style='vertical-align:middle;'><span>"+d.text+"</span></td></tr></table></div>")}t.push("</div>")}while(l<i.checkboxes.length)}if(i.radiobuttons.length>0){l=0;do{t.push("<div class='radiobuttonsDiv' style='display:inline-block;'>");for(c=0;l<i.radiobuttons.length&&!(c>0&&c%3==0);c++,l++){var r=i.radiobuttons[l],a=this.imagePath+(r.selected?"/radiobutton.png":"/radiobuttoff.png");t.push("<div class='radiobuttonDiv"+(r.enabled?"'":" itemDisabled'")+" id='"+this.id+"_nmdrCommands_radiobuttonDiv_"+r.id+"' style='display:block;' "+(r.enabled?"onclick=\"nmdr.core.$('"+this.id+"').selectRadioButton('"+i.id+"','"+r.id+"');\"":"")+"><table cellpadding='1' cellspacing='0' border='0'><tr><td style='vertical-align:middle;'><img id='"+this.id+"_nmdrCommands_radiobuttonDiv_"+r.id+"_img' src='"+a+"' title='"+r.tooltip+"'></td><td style='vertical-align:middle;'><span>"+r.text+"</span></td></tr></table></div>")}t.push("</div>")}while(l<i.radiobuttons.length)}if(i.comboboxes.length>0){var l=0;do{t.push("<div class='comboboxesDiv' style='display:inline-block;'>");for(var c=0;l<i.comboboxes.length&&!(c>0&&c%3==0);c++,l++){var m=i.comboboxes[l],p=this.id+"_nmdrCommands_comboboxDiv_"+m.id,h=m.selected?"<span>"+m.selected+"</span>":"";t.push("<div class='comboboxDiv"+(m.enabled?"'":" itemDisabled'")+" id='"+p+"' style='display:block;width:"+m.width+"px;height:"+m.height+"px;'"+(m.enabled?"onclick=\"nmdr.core.$('"+this.id+"').openComboBox(event,'"+m.id+"');\"":"")+"><table cellpadding='1' cellspacing='0' border='0' width='100%' height='100%'><tr><td id='"+p+"_input' style='vertical-align:middle;border-right:1px solid #ccc; overflow:hidden; white-space:nowrap; text-overflow:clip;'>"+h+"</td><td style='width:18px; vertical-align:middle; text-align:center;padding:0 0 2px 2px;'><img src='"+this.imagePath+"/menuf.png'></td></tr></table></div>")}t.push("</div>")}while(l<i.comboboxes.length)}t.push("<div class='groupnameDiv' style='display:block;cursor:default;'>"+i.text+"</div>"),t.push("</div>")}document.getElementById(this.id+"_nmdrCommands").innerHTML=t.join("")},e.readFromXML=function(t){var e=nmdr.core.xml.read(t,"Commands");this.commands={id:e.attributes.id,title:e.attributes.title,groups:[]};for(var i in e.childNodes)e.childNodes[i].name&&this.commands.groups.push(this.addGroup(e.childNodes[i]))},e.addGroup=function(t){var e={id:t.attributes.id,text:t.attributes.text,buttons:[],checkboxes:[],radiobuttons:[],comboboxes:[]};for(var i in t.childNodes){var o=t.childNodes[i].name;o&&"Button"==o?e.buttons.push(this.addButton(t.childNodes[i])):o&&"CheckBox"==o?e.checkboxes.push(this.addCheckBox(t.childNodes[i])):o&&"RadioButton"==o?e.radiobuttons.push(this.addRadioButton(t.childNodes[i])):o&&"ComboBox"==o&&e.comboboxes.push(this.addComboBox(t.childNodes[i]))}return e},e.addButton=function(t){var e={id:t.attributes.id,text:t.attributes.text,tooltip:t.attributes.tooltip,command:t.attributes.command,enabled:"true"==t.attributes.enabled.toLowerCase(),size:t.attributes.size,image:t.attributes.image,width:t.attributes.width?parseInt(t.attributes.width):this.buttonWidth,menu:[]};for(var i in t.childNodes)if(t.childNodes[i].name){var o=t.childNodes[i],n={id:o.attributes.id,text:o.attributes.text,tooltip:o.attributes.tooltip,description:o.attributes.description,image:o.attributes.image,command:o.attributes.command,enabled:"true"==o.attributes.enabled.toLowerCase()};e.menu.push(n)}return e},e.addCheckBox=function(t){return{id:t.attributes.id,text:t.attributes.text,tooltip:t.attributes.tooltip,command:t.attributes.command,enabled:"true"==t.attributes.enabled.toLowerCase(),checked:"true"==t.attributes.checked.toLowerCase()}},e.addRadioButton=function(t){return{id:t.attributes.id,text:t.attributes.text,tooltip:t.attributes.tooltip,command:t.attributes.command,enabled:"true"==t.attributes.enabled.toLowerCase(),selcted:"true"==t.attributes.selected.toLowerCase()}},e.addComboBox=function(t){return{id:t.attributes.id,items:t.attributes.items.split(","),selected:t.attributes.selected,command:t.attributes.command,enabled:"true"==t.attributes.enabled.toLowerCase(),width:parseInt(t.attributes.width),height:parseInt(t.attributes.height)}},e.prepareTestCommands=function(){return"<?xml version=\"1.0\"?><Commands id='MyCommands' title='MyCommands'><Group id='MyGroup' text='Group'><Button id='MyButton' text='Button' tooltip='Button' command='NewDocument' size='32' image='ribbon/32x32.png'></Button></Group></Ribbon>"},e}