function nmdrPHPCalendar(e){var t=nmdr.core.$(e,"nmdrPHPCalendar");if(null!=t)return t.PHP_URL="http://nalizadeh.com/javascript/php/",t.calData=[],t.ca=null,t.init=function(t){var a=this,n=nmdr.calendar(e);n.prepareUserData=function(e,t){a.readItems(e,t)},n.renderCell=function(e){for(var t=a.findItems(e),n="",r="",d="",s=0;s<t.length;s++){var i=a.calData[t[s]],l=new Date(i.startdate),o=new Date(i.enddate);switch(n=i.type,d+="<b>"+i.username+"</b><br>"+i.type+"&nbsp;"+i.text+"<br>"+l.asString()+" - "+o.asString(),s<t.length-1&&(d+="<br><br>"),i.type){case"Urlaub":r="background:#D8E4BC";break;case"Frei":r="background:#8DB4E2";break;case"Termin":r="background:#E6B8B7"}}return""==n?"":"<div style='width:100%;height:100%;"+r+"'><span class='hotspot' tooltip='"+d+"' style='font-weight:normal'>"+n+"</span></div>"},n.afterRendering=function(){nmdr.core.tooltips.start("hotspot","#FFFFAE","#FFB13D")},n.getYVTooltip=function(e){for(var t=a.findItems(e),n="",r=0;r<t.length;r++){var d=a.calData[t[r]],s=new Date(d.startdate),i=new Date(d.enddate);d.type,n+="<b>"+d.username+"</b><br>"+d.type+"&nbsp;"+d.text+"<br>"+s.asString()+" - "+i.asString(),r<t.length-1&&(n+="<br><br>")}return""==n?null:n},n.getYVBackground=function(e){return 0==a.findItems(e).length?null:"#D8E4BC"},n.prepareCommands=function(){return[{name:"Neu...",icon:"details.gif",enabled:!0,action:"new"},{name:"Öffnen...",icon:"editdetails.gif",enabled:!0,action:"view"},{name:"Bearbeiten...",icon:"editdetails.gif",enabled:!0,action:"edit"},{name:"Löschen...",icon:"delete.gif",enabled:!0,action:"delete"}]},n.executeCommand=function(e,t){var r=function(){n.refresh()};"new"==e&&a.editItem(t,r,!0),"view"==e&&a.viewItem(t,r),"edit"==e&&a.editItem(t,r),"delete"==e&&a.deleteItem(t,r)},n.checkCommands=function(e,t,n){for(var r=a.findItems(t),d=0;d<e.length;d++)"new"==e[d].action&&0!=r.length&&(e[d].enabled=!1),"view"==e[d].action&&0==r.length&&(e[d].enabled=!1),"edit"==e[d].action&&0==r.length&&(e[d].enabled=!1),"delete"==e[d].action&&0==r.length&&(e[d].enabled=!1);n()},t.view=n.defaultView,n.init(t),this.ca=n,nmdr.core.dialog.imagePath=this.ca.imagePath},t.dbREAD=function(e,t,a){nmdr.core.ajax.get(this.PHP_URL+"readData.php",e,t,a)},t.dbWRITE=function(e,t,a){nmdr.core.ajax.get(this.PHP_URL+"writeData.php",e,t,a)},t.dbDELETE=function(e,t,a){nmdr.core.ajax.get(this.PHP_URL+"deleteData.php",e,t,a)},t.findItems=function(e){for(var t=[],a=0;a<this.calData.length;a++)e.withoutTime().inRange(new Date(this.calData[a].startdate),new Date(this.calData[a].enddate))&&t.push(a);return t},t.readItems=function(e,t){var a=this,n=new Date(e),r=function(e){0==a.calData.length&&(a.calData.push({id:nmdr.core.ajax.createUUID(),username:"Nader",startdate:"06/03/2017",enddate:"06/04/2017",type:"Termin",text:""}),a.calData.push({id:nmdr.core.ajax.createUUID(),username:"Nader",startdate:"06/10/2017",enddate:"06/12/2017",type:"Frei",text:""}),a.calData.push({id:nmdr.core.ajax.createUUID(),username:"Nader",startdate:"06/20/2017",enddate:"06/20/2017",type:"Termin",text:"von 10:00 bis 12:00 Uhr"}),a.calData.push({id:nmdr.core.ajax.createUUID(),username:"Nader",startdate:"06/20/2017",enddate:"06/20/2017",type:"Termin",text:"von 14:00 bis 14:30 Uhr"}),a.calData.push({id:nmdr.core.ajax.createUUID(),username:"Nader",startdate:"06/25/2017",enddate:"07/10/2017",type:"Urlaub",text:"in Malaga"})),nmdr.core.dialog.message("Message","Server response<br><br>readyState: "+e.readyState+"<br>status: "+e.status+"<br>responseText: "+e.responseText,500,300,t)},d=this.view==this.yearView?new Date(n.getFullYear(),0,1).addMonth(-1):n.addMonth(-1),s=this.view==this.yearView?new Date(n.getFullYear(),11,31).addMonth(1):n.addMonth(1);this.dbREAD({startdate:d.toStr(),enddate:s.toStr()},function(e){if(-1!=e.responseText.indexOf("[BEG]")&&-1!=e.responseText.indexOf("[END]")&&e.responseText.length>10){a.calData=[];for(var n=e.responseText.substring(e.responseText.indexOf("[BEG]")+5,e.responseText.length-6).split("|"),d=0;d<n.length;d++){var s=n[d].split(";"),i={id:s[0],username:s[1],startdate:s[2],enddate:s[3],type:s[4],text:s[5]};a.calData.push(i)}t()}else r(e)},r)},t.editItem=function(e,t,a){var n=this,r=this.findItems(e),d=0==r.length?e:this.calData[r[0]];nmdr.core.dialog.dialog({title:"Bearbeiten",width:450,height:340,render:function(e){var t=e.id?e.id:nmdr.core.ajax.createUUID(),a=e.type?e.type:"";return"<table cellpadding='2' cellspacing='10' width='100%' border='0'><tr><td>Id:</td><td><input type='text' name='uuid' class='uuid' style='width: 260px;border:0;background:#fff' value='"+t+"' disabled></td></tr><tr><td>Name:</td><td><input type='text' name='username' class='username' style='width: 250px' value='"+(e.username?e.username:"")+"'></td></tr><tr><td>Anfang:</td><td><div class='startdate' id='startdate'></div></td></tr><tr><td>Ende:</td><td><div class='enddate' id='enddate'></div></td></tr><tr><td>Typ:</td><td><select name='type' class='type' style='width: 150px'>"+("<option"+("Urlaub"==a?" selected":"")+">Urlaub</option><option"+("Frei"==a?" selected":"")+">Frei</option><option"+("Termin"==a?" selected":"")+">Termin</option>")+"</select></td></tr><tr><td>Text:</td><td><input type='text' name='usertext' class='usertext' value='"+(e.text?e.text:"")+"' style='width: 300px'></td></tr></table>"},renderAfter:function(e){nmdr.datetime("startdate").init({date:new Date(e.startdate?e.startdate:e),imagePath:n.ca.imagePath}),nmdr.datetime("enddate").init({date:new Date(e.enddate?e.enddate:e),imagePath:n.ca.imagePath})},renderData:d,buttons:[{lable:"Save",className:"saveButton",callback:function(e){var r=e.getElementsByClassName("uuid")[0],d=e.getElementsByClassName("username")[0],s=e.getElementsByClassName("startdate")[0],i=e.getElementsByClassName("enddate")[0],l=e.getElementsByClassName("type")[0],o=e.getElementsByClassName("usertext")[0],c={id:r.value,username:d.value,startdate:s.getDate().toStr(),enddate:i.getDate().toStr(),type:l.options[l.selectedIndex].value,text:o.value};n.dbWRITE(c,function(e){nmdr.core.dialog.message("Nachricht",e.responseText,400,250,t)},function(e){if(a)n.calData.push(c);else{var r=findItems(new Date(c.startdate));if(r.length>0){var d=n.calData[r[0]];d.id=c.id,d.username=c.username,d.startdate=c.startdate,d.enddate=c.enddate,d.type=c.type,d.text=c.text}}var s="Folgende Daten wurden lokal gespeichert<br><br>Name: "+c.username+"<br>Anfang: "+c.startdate+"<br>Ende: "+c.enddate+"<br>Typ: "+c.type+"<br>Text: "+c.text;nmdr.core.dialog.message("Nachricht","Server response<br><br>readyState: "+e.readyState+"<br>status: "+e.status+"<br>responseText: "+e.responseText+"<br><br>"+s,600,450,t)})}},{lable:"Cancel",className:"cancelButton",callback:function(e){}}]})},t.deleteItem=function(e,t){var a=this;nmdr.core.dialog.confirm("Delete","Do you want to delete the selected calendar items?",function(n,r){if(n){var d=a.findItems(e);d.length>0&&a.dbDELETE(a.calData[d[0]],function(e){nmdr.core.dialog.alert("Delete","Items successfully deleted.",t)},function(e){a.calData.splice(d[0],1),nmdr.core.dialog.message("Message","Server response<br><br>readyState: "+e.readyState+"<br>status: "+e.status+"<br>responseText: "+e.responseText,500,300,t)})}})},t.viewItem=function(e,t){var a=this.findItems(e);if(a.length>0){var n=this.calData[a[0]],r="<table cellpadding='2' cellspacing='2' width='100%' border='0'><tr><td colspan='2'><b>Kalendareintrag</b></td></tr><tr><td colspan='2' style='height:10px'></td></tr><tr><td>Id:</td><td>"+n.id+"</td></tr><tr><td>Name:</td><td>"+n.username+"</td></tr><tr><td>Anfang:</td><td>"+n.startdate+"</td></tr><tr><td>Ende:</td><td>"+n.enddate+"</td></tr><tr><td>Typ:</td><td>"+n.type+"</td></tr><tr><td>Text:</td><td>"+n.text+"</td></tr></table>";nmdr.core.dialog.message("Kalendar",r,400,320)}},t}