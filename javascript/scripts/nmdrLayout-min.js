"use strict";function Row(t){this.parent=t.parent,this.sh=t.height?t.height:"auto",this.minWidth=t.minWidth,this.spacing=t.spacing,this.hAlign=t.hAlign,this.background=t.background,this.left=0,this.top=0,this.width=0,this.height=0,this.columns=[]}function Column(t){this.parent=t.parent,this.sw=t.width?t.width:"auto",this.target=t.target,this.background=t.background,this.left=0,this.top=0,this.width=0,this.height=0,this.rows=[]}function bodySize(){var t=window,n=document,i=n.documentElement,o=n.getElementsByTagName("body")[0],h=o.clientWidth,s=t.innerHeight||i.clientHeight||o.clientHeight;return{width:h,height:s}}function nmdrLayout(t,n){var i="string"==typeof t?document.getElementById(t):t;return n?i:(i.originRows=[],i.rows=[],i.bsize,i.debug=!1,i.addNewRow=function(t){var n=new Row(t?t:{});return this.originRows.push(n),{row:n,column:null}},i.start=function(t){"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(t){return this.substring(0,t.length)===t}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(t){return this.substring(this.length-t.length,this.length)===t});var n=this,i=setInterval(function(){"complete"==document.readyState&&(clearInterval(i),n.build(),window.addEventListener("resize",function(){n.build()}),t&&t())},10)},i.build=function(){this.makeResponsible(),this.dimColumns(this.rows,this.bsize.width,this.bsize.height),this.dimRows(this.rows,this.bsize.width,this.bsize.height);var t=[];t.push("<div id='"+this.id+"_mainContent' style='display:block;width:100%;height:100%;'>"),this.makeRows(t),t.push("</div>"),this.innerHTML=t.join("")},i.makeResponsible=function(){this.bsize=bodySize();var t=function(n,i,o){for(;i.length;)i.pop();for(var h=0;h<n.length;h++){var s=n[h].clone();if(s.spacing&&s.spacing>0)for(var e=s.columns.length-1,r=1,l=0;e>l;l++)s.addNewColumn({width:s.spacing+"px"},r),r+=2;if(s.minWidth&&s.minWidth>o.width)for(var a=0;a<s.columns.length;a++){var u=s.columns[a],d=new Row({height:u.target?s.sh:(s.spacing?s.spacing:10)+"px",spacing:s.spacing,hAlign:s.hAlign,background:s.background}),g=u.clone();g.sw="100%",d.addColumn(g),i.push(d)}else i.push(s)}for(var h=0;h<i.length;h++){s=i[h];for(var c=0,a=0;a<s.columns.length;a++){var u=s.columns[a];u.sw.endsWith("px")&&(c+=parseInt(u.sw))}if(s.hAlign&&0!=c){var w=o.width-c;w>0&&("center"==s.hAlign?(s.addNewColumn({width:w/2+"px"},0),s.addNewColumn({width:w/2+"px"})):"right"==s.hAlign?s.addNewColumn({width:w+"px"},0):"left"==s.hAlign&&s.addNewColumn({width:w+"px"}))}}for(var h=0;h<i.length;h++)for(var s=i[h],a=0;a<s.columns.length;a++){var u=s.columns[a];if(u.rows.length>0){var g=u.clone();t(g.rows,u.rows,o)}}};t(this.originRows,this.rows,this.bsize)},i.dimRows=function(t,n,i){for(var o=function(t){if(t.target){var n=document.getElementById(t.target);return{w:n.clientWidth,h:n.clientHeight}}for(var i=0,h=0;h<t.rows.length;h++){var s=t.rows[h],e=0;if(s.sh.endsWith("px"))e=parseInt(s.sh);else for(var r=0;r<s.columns.length;r++){var l=o(s.columns[r]);e=Math.max(e,l.h)}i+=e}return{w:0,h:i}},h=0;h<t.length;h++){var s=t[h];if("auto"==s.sh){for(var e=0,r=0;r<s.columns.length;r++)e=Math.max(e,o(s.columns[r]).h);s.sh=e+"px"}}for(var l=0,h=0;h<t.length;h++){var s=t[h];s.sh.endsWith("px")&&(s.height=parseInt(s.sh),l+=s.height)}for(var h=0;h<t.length;h++){var s=t[h];if(s.sh.endsWith("%")){var a=parseInt(s.sh);s.height=Math.max(0,Math.floor((i-l)*a/100))}}for(var u=0,h=0;h<t.length;h++){for(var s=t[h],r=0;r<s.columns.length;r++){var d=s.columns[r];d.height=s.height}s.left=0,s.top=u,s.width=n,u+=s.height}for(var h=0;h<t.length;h++)for(var s=t[h],r=0;r<s.columns.length;r++){var d=s.columns[r];d.rows.length>0&&this.dimRows(d.rows,d.width,d.height)}},i.dimColumns=function(t,n,i){for(var o=0;o<t.length;o++){for(var h=t[o],s=0,e=0;e<h.columns.length;e++){var r=h.columns[e];"auto"==r.sw&&(r.sw="100%")}for(var s=0,e=0;e<h.columns.length;e++){var r=h.columns[e];r.sw.endsWith("px")&&(r.width=parseInt(r.sw),s+=r.width)}s=n-s;for(var l=0,e=0;e<h.columns.length;e++){var r=h.columns[e];if(r.sw.endsWith("%")){var a=parseInt(r.sw);r.width=Math.max(0,Math.floor(s*a/100))}r.top=0,r.left=l,l+=r.width}for(var e=0;e<h.columns.length;e++){var r=h.columns[e];r.rows.length>0&&this.dimColumns(r.rows,r.width,r.height)}}},i.makeRows=function(t){for(var n=this.debug?"outline:1px solid blue;":"",i=function(t,o,h,s){var e=o.rows[s];t.push("<div id='"+h+"_row_"+s+"' style='position:absolute;display:block;left:"+e.left+"px;top:"+e.top+"px;width:"+e.width+"px;height:"+e.height+"px;"+(e.background?"background:"+e.background+";":"")+n+"'>");for(var r=0;r<e.columns.length;r++){var l=e.columns[r],a="";if(l.target){var u=document.getElementById(l.target);u.style.height="100%",u.style.width="100%",a=u.outerHTML}t.push("<div id='"+h+"_row_"+s+"_col_"+r+"' class='cell' style='position:absolute;display:block;width:"+l.width+"px;height:"+e.height+"px;left:"+l.left+"px;top:"+l.top+"px;"+(l.background?"background:"+l.background+";":"")+n+"'>"+a);for(var l=e.columns[r],d=0;d<l.rows.length;d++)i(t,l,h+"_row_"+d+"_col_"+r,d);t.push("</div>")}t.push("</div>")},o=0;o<this.rows.length;o++)i(t,this,this.id,o)},i.showDebug=function(){var t="",n=function(i,o){for(var h=0;h<i.length;h++){var s=i[h];t+=o+"<div>"+s.width+","+s.height+","+s.top+(s.calc?",true":"")+"\n";for(var e=0;e<s.columns.length;e++){var r=s.columns[e];r.rows.length>0?t=n(r.rows,o+"   "):t+=o+"   <div>"+r.width+","+r.height+(r.target?","+r.target:"")+"</div>\n"}t+=o+"</div>\n"}return t};n(this.rows,""),alert(t)},i)}Row.prototype.addNewColumn=function(t,n){t?t.parent=this:t={parent:this};var i=new Column(t);return"undefined"==typeof n?this.columns.push(i):this.columns.splice(n,0,i),{row:this,col:i}},Row.prototype.addColumn=function(t,n){return t.parent=this,"undefined"==typeof n?this.columns.push(t):this.columns.splice(n,0,t),{row:this,col:t}},Row.prototype.clone=function(){for(var t=new Row({parent:this.parent,height:this.sh,minWidth:this.minWidth,spacing:this.spacing,hAlign:this.hAlign,background:this.background}),n=0;n<this.columns.length;n++)t.columns.push(this.columns[n].clone());return t},Column.prototype.addNewRow=function(t){t?t.parent=this:t={parent:this};var n=new Row(t);return this.rows.push(n),{row:n,col:this}},Column.prototype.addRow=function(t){return t.parent=this,this.rows.push(t),{row:t,col:this}},Column.prototype.clone=function(){for(var t=new Column({parent:this.parent,width:this.sw,target:this.target,background:this.background}),n=0;n<this.rows.length;n++)t.rows.push(this.rows[n].clone());return t};